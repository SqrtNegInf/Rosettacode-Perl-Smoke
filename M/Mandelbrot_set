#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Mandelbrot_set
#c# 2018-08-18 <RC
#p# OK

use strict;
use warnings;
use feature 'say';
my $result;

# translation / optimization of the ruby solution

use Math::Complex;

sub mandelbrot {
    my ($z, $c) = @_[0,0];
    for (1 .. 20) {
        $z = $z * $z + $c;
        return $_ if abs $z > 2;
    }
}

for (my $y = 1; $y >= -1; $y -= 0.05) {
    for (my $x = -2; $x <= 0.5; $x += 0.0315)
        {$result .= mandelbrot($x + $y * i) ? ' ' : '#'}
    $result .= "\n"
}

say $result; 
my $ref = <<'EOD';
                                                                                
                                                                                
                                                            #                   
                                                        #  ###  #               
                                                        ########                
                                                       #########                
                                                         ######                 
                                             ##    ## ############  #           
                                              ### ###################      #    
                                              #############################     
                                              ############################      
                                          ################################      
                                           ################################     
                                         #################################### # 
                          #     #        ###################################    
                          ###########    ###################################    
                           ###########   #####################################  
                         ############## ####################################    
                        ####################################################    
                     ######################################################     
 ########################################################################       
                     ######################################################     
                        ####################################################    
                         ############## ####################################    
                           ###########   #####################################  
                          ###########    ###################################    
                          #     #        ###################################    
                                         #################################### # 
                                           ################################     
                                          ################################      
                                              ############################      
                                              #############################     
                                              ### ###################      #    
                                             ##    ## ############  #           
                                                         ######                 
                                                       #########                
                                                        ########                
                                                        #  ###  #               
                                                            #                   
                                                                                
EOD

use Test::More;
is ($result, $ref);
done_testing;
