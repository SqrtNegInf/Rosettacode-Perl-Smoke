#!/usr/local/bin/perl
## quick & dirty critic
#    2023-07-15
# perl -e '`rc-critic $_/* > tmp/$_.critic` for "A".."Z"'

use v5.36;

use Perl::Critic;

for my $file (@ARGV) {
    my $exclude = join '|', 
    'die..used',
    'Code before',
    'does not end with',
    'without a label',
    'prototypes',
    'use a real number',
    'pragma."const',
    'without ..x',
    'always unpack',
    'package variable',
    'expression form',
    'magic variable',
    'close filehandles',
    'Return value of .open',
    'Ambiguously named variable',
    ;

    my $critic = Perl::Critic->new(-severity => 3);
    my @violations = grep { ! /$exclude/i } $critic->critique($file);
    print "\n= $file\n" . join '', @violations if @violations
}

__END__

new( [ -profile => $FILE, -severity => $N, -theme => $string, -include
    => \@PATTERNS, -exclude => \@PATTERNS, -top => $N, -only => $B,
    -profile-strictness => $PROFILE_STRICTNESS_{WARN|FATAL|QUIET}, -force =>
    $B, -verbose => $N ], -color => $B, -pager => $string, -allow-unsafe =>
    $B, -criticism-fatal => $B)"
