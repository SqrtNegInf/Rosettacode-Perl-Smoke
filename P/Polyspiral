#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Polyspiral
#c# 2018-11-RC >RC
#p# BROKEN

use feature 'say';
use warnings;
use strict 'vars';

__END__

# Sort of an ersatz animation. Write updates to a svg file, most modern viewers will update as the content changes.

use SVG;
use Time::HiRes;

use constant tau => 2 * 2 * atan2(1, 0);

my $w = 600;
my $h = 600;
 
for $a (3..33) {
    my $angle = $a/tau;
    my $x1 = $w/2;
    my $y1 = $h/2;
    my @lines;
 
    for (1..144) {
        my $length = 3 * $_;
        my ($x2, $y2) = ($x1, $y1) x+x |cis($angle * $_).realsx.round(.01) x*x $length ;
        push @lines: 'line' => [:x1($x1.clone), :y1($y1.clone), :x2($x2.clone), :y2($y2.clone),
                                :style("stroke:rgb({hsv2rgb(($_*5 % 360)/360,1,1).join: ','})")];
        ($x1, $y1) = $x2, $y2;
    }
 
    my $fname = "run/polyspiral.svg";
    $fname.say( SVG.serialize(
        svg => [
            width => $w, height => $h, style => 'stroke:rgb(0,0,0)',
            :rect[:width<100%>, :height<100%>, :fill<black>],
            |@lines,
        ],)
    );
    close $fname;
    sleep .15;
}
 
# good Perl! but not needed...
sub hsv2rgb {
    my($h,$s,$v) = @_;
    my $c = $v * $s;
    my $x = $c * (1 - ( abs( (fmod(($h*6),2)) - 1 ) ) );
    our $m = $v - $c;
    my @rgb;
       if ( $h < 1/6 ){ @rgb = scale($c, $x, 0) }
    elsif ( $h < 2/6 ){ @rgb = scale($x, $c, 0) }
    elsif ( $h < 3/6 ){ @rgb = scale(0, $c, $x) }
    elsif ( $h < 4/6 ){ @rgb = scale(0, $x, $c) }
    elsif ( $h < 5/6 ){ @rgb = scale($x, 0, $c) }
    else              { @rgb = scale($c, 0, $x) }
    sub scale { int(255*($_[0]+$m)), int(255*($_[1]+$m)), int(255*($_[2]+$m)) }
    return \@rgb;
}

__END__

=={{header|Perl}}==
{{trans|Perl 6}}
<lang perl></lang>
{{out}}
<pre style="height:35ex"></pre>
