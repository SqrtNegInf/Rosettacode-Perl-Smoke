#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Calendar
#c# 2021-08-04 <RC
#p# OK

my @res;

use strict;
use warnings;
use feature 'say';

use Time::Local;

my $year  = shift // 1969;
my $width = shift // 80;
my $columns = int +($width + 2) / 22 or die "width too short at $width";
push @res, map { center($_, $width) } '<reserved for snoopy>', $year;
my @months = qw( January February March April May June July August September October November December );
my @days = qw( 31 28 31 30 31 30 31 31 30 31 30 31 );
(gmtime 86400 + timegm 1,1,1,28,1,$year)[3] == 29 and $days[1]++;

my @blocks = map { # block per month
  my $m = center($months[$_], 20) . "\nSu Mo Tu We Th Fr Sa\n" .
    "00 00 00 00 00 00 00\n" x 6;
  $m =~ s/00/  / for 1 .. (gmtime timegm 1,1,1,1,$_,$year )[6]; # day of week
  $m =~ s/00/ center($_, 2) /e for 1 .. $days[$_];
  $m =~ s/00/  /g;
  [ split /\n/, $m ]
} 0 .. 11;

while( my @row = splice @blocks, 0, $columns ) { # print by rows of months
    push @res, center(join('  ', map shift @$_, @row), $width) for 1 .. @{$row[0]};
}

sub center {
    my($string, $w) = @_;
    sprintf "%${w}s", $string . ' ' x ($w - length($string) >> 1);
}

say my $result = join "\n", @res;

my $ref = <<'EOD';
                              <reserved for snoopy>                             
                                      1969                                      
               January              February                March               
        Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa        
                  1  2  3  4                     1                     1        
         5  6  7  8  9 10 11   2  3  4  5  6  7  8   2  3  4  5  6  7  8        
        12 13 14 15 16 17 18   9 10 11 12 13 14 15   9 10 11 12 13 14 15        
        19 20 21 22 23 24 25  16 17 18 19 20 21 22  16 17 18 19 20 21 22        
        26 27 28 29 30 31     23 24 25 26 27 28     23 24 25 26 27 28 29        
                                                    30 31                       
                April                  May                  June                
        Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa        
               1  2  3  4  5               1  2  3   1  2  3  4  5  6  7        
         6  7  8  9 10 11 12   4  5  6  7  8  9 10   8  9 10 11 12 13 14        
        13 14 15 16 17 18 19  11 12 13 14 15 16 17  15 16 17 18 19 20 21        
        20 21 22 23 24 25 26  18 19 20 21 22 23 24  22 23 24 25 26 27 28        
        27 28 29 30           25 26 27 28 29 30 31  29 30                       
                                                                                
                July                 August               September             
        Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa        
               1  2  3  4  5                  1  2      1  2  3  4  5  6        
         6  7  8  9 10 11 12   3  4  5  6  7  8  9   7  8  9 10 11 12 13        
        13 14 15 16 17 18 19  10 11 12 13 14 15 16  14 15 16 17 18 19 20        
        20 21 22 23 24 25 26  17 18 19 20 21 22 23  21 22 23 24 25 26 27        
        27 28 29 30 31        24 25 26 27 28 29 30  28 29 30                    
                              31                                                
               October              November              December              
        Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa        
                  1  2  3  4                     1      1  2  3  4  5  6        
         5  6  7  8  9 10 11   2  3  4  5  6  7  8   7  8  9 10 11 12 13        
        12 13 14 15 16 17 18   9 10 11 12 13 14 15  14 15 16 17 18 19 20        
        19 20 21 22 23 24 25  16 17 18 19 20 21 22  21 22 23 24 25 26 27        
        26 27 28 29 30 31     23 24 25 26 27 28 29  28 29 30 31                 
                              30                                                
EOD

use Test::More;
chomp $ref;
is ($result, $ref);
done_testing();

__END__

When run with args 1969 132 produces:

                                                        <reserved for snoopy>                                                       
                                                                1969                                                                

        January              February                March                 April                  May                  June         
 Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa 
           1  2  3  4                     1                     1         1  2  3  4  5               1  2  3   1  2  3  4  5  6  7 
  5  6  7  8  9 10 11   2  3  4  5  6  7  8   2  3  4  5  6  7  8   6  7  8  9 10 11 12   4  5  6  7  8  9 10   8  9 10 11 12 13 14 
 12 13 14 15 16 17 18   9 10 11 12 13 14 15   9 10 11 12 13 14 15  13 14 15 16 17 18 19  11 12 13 14 15 16 17  15 16 17 18 19 20 21 
 19 20 21 22 23 24 25  16 17 18 19 20 21 22  16 17 18 19 20 21 22  20 21 22 23 24 25 26  18 19 20 21 22 23 24  22 23 24 25 26 27 28 
 26 27 28 29 30 31     23 24 25 26 27 28     23 24 25 26 27 28 29  27 28 29 30           25 26 27 28 29 30 31  29 30                
                                             30 31                                                                                  
         July                 August               September              October              November              December       
 Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa  Su Mo Tu We Th Fr Sa 
        1  2  3  4  5                  1  2      1  2  3  4  5  6            1  2  3  4                     1      1  2  3  4  5  6 
  6  7  8  9 10 11 12   3  4  5  6  7  8  9   7  8  9 10 11 12 13   5  6  7  8  9 10 11   2  3  4  5  6  7  8   7  8  9 10 11 12 13 
 13 14 15 16 17 18 19  10 11 12 13 14 15 16  14 15 16 17 18 19 20  12 13 14 15 16 17 18   9 10 11 12 13 14 15  14 15 16 17 18 19 20 
 20 21 22 23 24 25 26  17 18 19 20 21 22 23  21 22 23 24 25 26 27  19 20 21 22 23 24 25  16 17 18 19 20 21 22  21 22 23 24 25 26 27 
 27 28 29 30 31        24 25 26 27 28 29 30  28 29 30              26 27 28 29 30 31     23 24 25 26 27 28 29  28 29 30 31          
                       31                                                                30                                         



