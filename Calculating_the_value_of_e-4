#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Calculating_the_value_of_e
#c# 2018-08-23
#p# OK
#n# tweak *-3 code to produce the same # of digits as Perl 6, much slower

use feature 'say';

use bigrat;

use Math::Decimal qw(dec_canonise dec_mul dec_rndiv_and_rem dec_sub);

# very inefficient
#sub factorial { my $r = 1; $r *= $_ for 1..shift; $r; }
#for $n (0..600) { $sum += 1/factorial($n); }

$sum = 1.0;
$f   = 1;
for $n (1..600) {
    $f *= $n;
    $sum += 1/$f;
}

my($num,$den) = $sum =~ m#(\d+)/(\d+)#;
say "numerator:   $num";
say "denominator: $den";

$ten     = dec_canonise("10");
$num_dec = dec_canonise($num);
$den_dec = dec_canonise($den);

($q, $r) = dec_rndiv_and_rem("FLR", $num_dec, $den_dec);
$e = "$q.";
for (1..1150) {
    $num_dec = dec_mul($r, $ten);
    ($q, $r) = dec_rndiv_and_rem("FLR", $num_dec, $den_dec);
    $e .= $q;
}

$edec = dec_canonise($e);
$ref = dec_canonise("2.71828182845904523536028747135266249775724709369995957496696762772407663035354759457138217852516642742746639193200305992181741359662904357290033429526059563073813232862794349076323382988075319525101901157383418793070215408914993488416750924476146066808226480016847741185374234544243710753907774499206955170276183860626133138458300075204493382656029760673711320070932870912744374704723069697720931014169283681902551510865746377211125238978442505695369677078544996996794686445490598793163688923009879312773617821542499922957635148220826989519366803318252886939849646510582093923982948879332036250944311730123819706841614039701983767932068328237646480429531180232878250981945581530175671736133206981125099618188159304169035159888851934580727386673858942287922849989208680582574927961048419844436346324496848756023362482704197862320900216099023530436994184914631409343173814364054625315209618369088870701676839642437814059271456354906130310720851038375051011574770417189861068739696552126715468895703503540212340784981933432106817012100562788023519303322474501585390473041995777709350366041699732972508868769664035557071622684471625608");

$delta = dec_sub($ref,$edec);
say 'ref:';
say $ref;
say 'e:';
say $e;
say 'delta:';
say $delta;

use Test::More;
ok($delta =~ /^0\.0{1131}/);
done_testing();
