#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Engel_expansion
#c# 2022-09-17 >RC
#p# OK
#n# works quickly for most, slows down for highest-precision (π and sqrt 2):
#n#     524.54s user 8.84s system 83% cpu 10:42.04 total

my @res;

use v5.36;
use bigrat;

use List::Util <min product>;

sub ceiling ($n) { $n == int $n ? $n : int $n + 1 }

sub to_engel ($rat) { 
    my @E;
    while ($rat) { 
        push @E, ceiling 1/$rat; 
        $rat = $rat*$E[-1] - 1; 
    } 
    @E
}

#sub product (@a) { my $p=1; for (@a) { $p *= $_ }; $p }  # also works

sub from_engel (@expanded) { 
    my($sum,@a);
    map { push @a, $_; $sum += 1/product(@a) } @expanded;
    $sum
}

for my $rat (
    #  low precision 𝜋, 𝑒, √2 and 1.5 to a power
    3.14159265358979, 2.71828182845904, 1.414213562373095, 1.5 ** 5,

    # high precision 𝜋, 𝑒, and √2 and 1.5 to a power
    #3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211,

    #2.71828182845904523536028747135266249775724709369995957496696762772407663035354759457138217852516642743,

    #1.4142135623730950488016887242096980785696718753769480731766797379907324784621070388503875343276415727350138462309122970249248360558507372126441214970999358314132226659275055927558,

    1.5 ** 8,
    ) 
    {
    push @res, "Rational number: $rat";
    my @expanded = to_engel $rat;
    push @res, "Engel expansion: " . join ' ', @expanded[0.. min($#expanded,30)]; #.head(30);
    push @res, " Converted back: " . from_engel(@expanded);
    push @res, '';
}

my $result = join "\n", @res;

my $ref = <<'END';
Rational number: 314159265358979/100000000000000
Engel expansion: 1 1 1 8 8 17 19 300 1991 2768 4442 4830 10560 37132 107315 244141 651042 1953125
 Converted back: 314159265358979/100000000000000

Rational number: 16989261427869/6250000000000
Engel expansion: 1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 17 82 144 321 2289 9041 21083 474060 887785 976563 1953125
 Converted back: 16989261427869/6250000000000

Rational number: 282842712474619/200000000000000
Engel expansion: 1 3 5 5 16 18 78 102 120 144 260 968 18531 46065 63005 65105 78125
 Converted back: 282842712474619/200000000000000

Rational number: 243/32
Engel expansion: 1 1 1 1 1 1 1 2 6 8
 Converted back: 243/32

Rational number: 6561/256
Engel expansion: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 4 32
 Converted back: 6561/256
END

my $ref_rat = <<'END';
Rational number: 314159265358979/100000000000000
Engel expansion: 1 1 1 8 8 17 19 300 1991 2768 4442 4830 10560 37132 107315 244141 651042 1953125
 Converted back: 314159265358979/100000000000000

Rational number: 16989261427869/6250000000000
Engel expansion: 1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 17 82 144 321 2289 9041 21083 474060 887785 976563 1953125
 Converted back: 16989261427869/6250000000000

Rational number: 282842712474619/200000000000000
Engel expansion: 1 3 5 5 16 18 78 102 120 144 260 968 18531 46065 63005 65105 78125
 Converted back: 282842712474619/200000000000000

Rational number: 243/32
Engel expansion: 1 1 1 1 1 1 1 2 6 8
 Converted back: 243/32

Rational number: 31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211/10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
Engel expansion: 1 1 1 8 8 17 19 300 1991 2492 7236 10586 34588 63403 70637 1236467 5417668 5515697 5633167 7458122 9637848 9805775 41840855 58408380 213130873 424342175 2366457522 4109464489 21846713216 27803071890 31804388758
 Converted back: 31415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211/10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Rational number: 271828182845904523536028747135266249775724709369995957496696762772407663035354759457138217852516642743/100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
Engel expansion: 1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30
 Converted back: 271828182845904523536028747135266249775724709369995957496696762772407663035354759457138217852516642743/100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Rational number: 7071067811865475244008443621048490392848359376884740365883398689953662392310535194251937671638207863675069231154561485124624180279253686063220607485499679157066113329637527963779/5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
Engel expansion: 1 3 5 5 16 18 78 102 120 144 251 363 1402 31169 88630 184655 259252 298770 4196070 38538874 616984563 1975413035 5345718057 27843871197 54516286513 334398528974 445879679626 495957494386 2450869042061 2629541150527 20209084928875
 Converted back: 7071067811865475244008443621048490392848359376884740365883398689953662392310535194251937671638207863675069231154561485124624180279253686063220607485499679157066113329637527963779/5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Rational number: 6561/256
Engel expansion: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 4 32
 Converted back: 6561/256

END

my $moar = <<'END';
Engel expansion: 1 1 1 8 8 17 19 300 1991 2768 4442 4830 10560 37132 107315 244141 651042 1953125
Engel expansion: 1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 17 82 144 321 2289 9041 21083 474060 887785 976563 1953125
Engel expansion: 1 3 5 5 16 18 78 102 120 144 260 968 18531 46065 63005 65105 78125
Engel expansion: 1 1 1 1 1 1 1 2 6 8
Engel expansion: 1 1 1 8 8 17 19 300 1991 2492 7236 10586 34588 63403 70637 1236467 5417668 5515697 5633167 7458122 9637848 9805775 41840855 58408380 213130873 424342175 2366457522 4109464489 21846713216 27803071890
Engel expansion: 1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29
Engel expansion: 1 3 5 5 16 18 78 102 120 144 251 363 1402 31169 88630 184655 259252 298770 4196070 38538874 616984563 1975413035 5345718057 27843871197 54516286513 334398528974 445879679626 495957494386 2450869042061 2629541150527
Engel expansion: 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 4 32
END

use Test::More;
#chomp $ref;
is($result, $ref);
#is(($result =~ s/\s//gr), ($ref =~ s/\s//gr));
done_testing();

__END__

=={{header|Perl}}==
{{trans|Raku}}
<syntaxhighlight lang="perl" line>
</syntaxhighlight>
{{out}}
<pre style="height:20ex">
</pre>
