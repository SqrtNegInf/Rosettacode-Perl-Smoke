#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Evolutionary_algorithm
#c# 2018-08-01 <RC
#p# OK

use v5.36;

my $result;
srand 123456;

use List::Util 'reduce';
use List::MoreUtils 'false';

sub randElm (@A) { $A[int rand @A] }

sub minBy ($f,@A) {
    reduce {$f->($b) < $f->($a) ? $b : $a} @A
}

sub zip (@A) {
    @A or return ();
    for (my ($n, @a) = 0 ;; ++$n) {
        my @row;
        for (@A) {
            $n < @$_ or return @a;
            push @row, $_->[$n];
        }
        push @a, \@row;
    }
}

my $C = 100;
my $mutation_rate = .05;
my @target = split '', 'METHINKS IT IS LIKE A WEASEL';
my @valid_chars = (' ', 'A' .. 'Z');

sub fitness ($rA) {
    my @A = $rA;
    false {$_->[0] eq $_->[1]} zip shift(@A), \@target      # clever
}

sub mutate ($rate,@A) {
    [map {rand() < $rate ? randElm @valid_chars : $_} @{shift @A}];
}

my $parent = [map {randElm @valid_chars} @target];

while (fitness $parent) {
    $parent =
       minBy \&fitness,
       map {mutate $mutation_rate, $parent}
       1 .. $C;
    $result .= join('', @$parent) . "\n";
}

say $result; 

my $ref = <<'EOD';
YRQEAGEZNRGJJ AHQVQYZMYYAUZO
YHQEAGEZNRGJJ AKQDQYZMYLAUZL
YGUEAGKZNRGJJ AKQDAYZMYLAUZL
YGUEAGKZNRGJJ AKQDEYZMYQAUZL
YGUEAGKZNRGJJ AKQEEYZMYQAUZL
YGUEAGKZNEGIJ  KQEEYZTYQAUZL
YGGEANKZNEGIJ  KQEELZTYQAUZL
YGTEANKZNEGSJ  KQEELZTYQAUZL
YGTEANKZNEGSJ  KQKELZTYQAUZL
YGTEANKTNEGSJ  KQKELZTYQASZL
YGTEANKTNEGSJ  KQKELZTIQASZL
MGTEANKTNEGSJ  KQKELZTIQASZL
MGTEANKTNEGSJ  AQKELZTIEASZL
MGTEANKTNETSJ  AQKELZTJEASZL
MGTEINKLNETSJ  AQKELZTJEASZL
MGTEINKLNET JB AQKELZTJEASZL
MGTEINKLNET JB LVKELZTJEASZL
MPTEINKLNIT JB LVKELZTJEASZL
MPTOINKLNIT JB LVKELZTWEASZL
MPTOINKL IT JB LVKELZTWEASZL
MPTHINKL IT JB LVKELZTWEASZL
MPTHINKL IT JB LVKELZTWEASZL
MPTHINKL IT JB LVKELZTWEASZL
MPTHINKL IT II LVKELZTWEASZL
MPTHINKL IT II LVKELZTWEASZL
MPTHINKL IT II LVKELZTWEASZL
MPTHINKL IT II LVKELGTWEASZL
MPTHINKL IT IY LVKELX WEASZL
MPTHINKL IT ID LVKELX WEASZL
MPTHINKL IT ID LVKELX WEASZL
METHINKL IT ID LVKELX WEASZL
METHINKL IT ID LVKELX WEASZL
METHINKL IT ID LVKELX WEASZL
METHINKL IT ID LVKELX WEASZL
METHINKL IT ID LVKELJ WEASZL
METHINKL IT ID LVKELJ WEASZL
METHINKL IT ID LVKELA WEASZL
METHINKL IT ID LVKELA WEASZL
METHINKL IT ID LVKELA WEASZL
METHINKL IT ID LVKELA WEASZL
METHINKL IT IS LVKELA WEASZL
METHINKL IT IS LVKELA WEASZL
METHINKL IT IS LVKELA WEASZL
METHINKL IT IS LVKELA WEASZL
METHINKL IT IS LVKELA WEASZL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKELA WEASEL
METHINKL IT IS LVKE A WEASEL
METHINKL IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKD IT IS LDKE A WEASEL
METHINKS IT IS LDKE A WEASEL
METHINKS IT IS LDKE A WEASEL
METHINKS IT IS LDKE A WEASEL
METHINKS IT IS LDKE A WEASEL
METHINKS IT IS LIKE A WEASEL
EOD

use Test::More;
is ($result, $ref);
done_testing();
