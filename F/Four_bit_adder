#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Four_bit_adder
#c# 2018-08-08 <RC
#p# OK

use strict;
use warnings;
use feature 'say';
my $result;

sub dec2bin { sprintf '%04b', shift }
sub bin2dec { oct '0b'.shift }
sub bin2bits { reverse split(//, substr(shift,0,shift)); }
sub bits2bin { join '', map { 0+$_ } reverse @_ }

sub bxor {
  my($a, $b) = @_;
  (!$a & $b) | ($a & !$b);
}

sub half_adder {
  my($a, $b) = @_;
  ( bxor($a,$b), $a & $b );
}

sub full_adder {
  my($a, $b, $c) = @_;
  my($s1, $c1) = half_adder($a, $c);
  my($s2, $c2) = half_adder($s1, $b);
  ($s2, $c1 | $c2);
}

sub four_bit_adder {
  my($a, $b) = @_;
  my @abits = bin2bits($a,4);
  my @bbits = bin2bits($b,4);

  my($s0,$c0) = full_adder($abits[0], $bbits[0], 0);
  my($s1,$c1) = full_adder($abits[1], $bbits[1], $c0);
  my($s2,$c2) = full_adder($abits[2], $bbits[2], $c1);
  my($s3,$c3) = full_adder($abits[3], $bbits[3], $c2);
  (bits2bin($s0, $s1, $s2, $s3), $c3);
}

$result .= " A    B      A      B   C    S  sum\n";
for my $a (0 .. 15) {
  for my $b (0 .. 15) {
    my($abin, $bbin) = map { dec2bin($_) } $a,$b;
    my($s,$c) = four_bit_adder( $abin, $bbin );
    $result .= sprintf "%2d + %2d = %s + %s = %s %s = %2d\n",
           $a, $b, $abin, $bbin, $c, $s, bin2dec($c.$s);
  }
}

say $result; 
my $ref = <<'EOD';
 A    B      A      B   C    S  sum
 0 +  0 = 0000 + 0000 = 0 0000 =  0
 0 +  1 = 0000 + 0001 = 0 0001 =  1
 0 +  2 = 0000 + 0010 = 0 0010 =  2
 0 +  3 = 0000 + 0011 = 0 0011 =  3
 0 +  4 = 0000 + 0100 = 0 0100 =  4
 0 +  5 = 0000 + 0101 = 0 0101 =  5
 0 +  6 = 0000 + 0110 = 0 0110 =  6
 0 +  7 = 0000 + 0111 = 0 0111 =  7
 0 +  8 = 0000 + 1000 = 0 1000 =  8
 0 +  9 = 0000 + 1001 = 0 1001 =  9
 0 + 10 = 0000 + 1010 = 0 1010 = 10
 0 + 11 = 0000 + 1011 = 0 1011 = 11
 0 + 12 = 0000 + 1100 = 0 1100 = 12
 0 + 13 = 0000 + 1101 = 0 1101 = 13
 0 + 14 = 0000 + 1110 = 0 1110 = 14
 0 + 15 = 0000 + 1111 = 0 1111 = 15
 1 +  0 = 0001 + 0000 = 0 0001 =  1
 1 +  1 = 0001 + 0001 = 0 0010 =  2
 1 +  2 = 0001 + 0010 = 0 0011 =  3
 1 +  3 = 0001 + 0011 = 0 0100 =  4
 1 +  4 = 0001 + 0100 = 0 0101 =  5
 1 +  5 = 0001 + 0101 = 0 0110 =  6
 1 +  6 = 0001 + 0110 = 0 0111 =  7
 1 +  7 = 0001 + 0111 = 0 1000 =  8
 1 +  8 = 0001 + 1000 = 0 1001 =  9
 1 +  9 = 0001 + 1001 = 0 1010 = 10
 1 + 10 = 0001 + 1010 = 0 1011 = 11
 1 + 11 = 0001 + 1011 = 0 1100 = 12
 1 + 12 = 0001 + 1100 = 0 1101 = 13
 1 + 13 = 0001 + 1101 = 0 1110 = 14
 1 + 14 = 0001 + 1110 = 0 1111 = 15
 1 + 15 = 0001 + 1111 = 1 0000 = 16
 2 +  0 = 0010 + 0000 = 0 0010 =  2
 2 +  1 = 0010 + 0001 = 0 0011 =  3
 2 +  2 = 0010 + 0010 = 0 0100 =  4
 2 +  3 = 0010 + 0011 = 0 0101 =  5
 2 +  4 = 0010 + 0100 = 0 0110 =  6
 2 +  5 = 0010 + 0101 = 0 0111 =  7
 2 +  6 = 0010 + 0110 = 0 1000 =  8
 2 +  7 = 0010 + 0111 = 0 1001 =  9
 2 +  8 = 0010 + 1000 = 0 1010 = 10
 2 +  9 = 0010 + 1001 = 0 1011 = 11
 2 + 10 = 0010 + 1010 = 0 1100 = 12
 2 + 11 = 0010 + 1011 = 0 1101 = 13
 2 + 12 = 0010 + 1100 = 0 1110 = 14
 2 + 13 = 0010 + 1101 = 0 1111 = 15
 2 + 14 = 0010 + 1110 = 1 0000 = 16
 2 + 15 = 0010 + 1111 = 1 0001 = 17
 3 +  0 = 0011 + 0000 = 0 0011 =  3
 3 +  1 = 0011 + 0001 = 0 0100 =  4
 3 +  2 = 0011 + 0010 = 0 0101 =  5
 3 +  3 = 0011 + 0011 = 0 0110 =  6
 3 +  4 = 0011 + 0100 = 0 0111 =  7
 3 +  5 = 0011 + 0101 = 0 1000 =  8
 3 +  6 = 0011 + 0110 = 0 1001 =  9
 3 +  7 = 0011 + 0111 = 0 1010 = 10
 3 +  8 = 0011 + 1000 = 0 1011 = 11
 3 +  9 = 0011 + 1001 = 0 1100 = 12
 3 + 10 = 0011 + 1010 = 0 1101 = 13
 3 + 11 = 0011 + 1011 = 0 1110 = 14
 3 + 12 = 0011 + 1100 = 0 1111 = 15
 3 + 13 = 0011 + 1101 = 1 0000 = 16
 3 + 14 = 0011 + 1110 = 1 0001 = 17
 3 + 15 = 0011 + 1111 = 1 0010 = 18
 4 +  0 = 0100 + 0000 = 0 0100 =  4
 4 +  1 = 0100 + 0001 = 0 0101 =  5
 4 +  2 = 0100 + 0010 = 0 0110 =  6
 4 +  3 = 0100 + 0011 = 0 0111 =  7
 4 +  4 = 0100 + 0100 = 0 1000 =  8
 4 +  5 = 0100 + 0101 = 0 1001 =  9
 4 +  6 = 0100 + 0110 = 0 1010 = 10
 4 +  7 = 0100 + 0111 = 0 1011 = 11
 4 +  8 = 0100 + 1000 = 0 1100 = 12
 4 +  9 = 0100 + 1001 = 0 1101 = 13
 4 + 10 = 0100 + 1010 = 0 1110 = 14
 4 + 11 = 0100 + 1011 = 0 1111 = 15
 4 + 12 = 0100 + 1100 = 1 0000 = 16
 4 + 13 = 0100 + 1101 = 1 0001 = 17
 4 + 14 = 0100 + 1110 = 1 0010 = 18
 4 + 15 = 0100 + 1111 = 1 0011 = 19
 5 +  0 = 0101 + 0000 = 0 0101 =  5
 5 +  1 = 0101 + 0001 = 0 0110 =  6
 5 +  2 = 0101 + 0010 = 0 0111 =  7
 5 +  3 = 0101 + 0011 = 0 1000 =  8
 5 +  4 = 0101 + 0100 = 0 1001 =  9
 5 +  5 = 0101 + 0101 = 0 1010 = 10
 5 +  6 = 0101 + 0110 = 0 1011 = 11
 5 +  7 = 0101 + 0111 = 0 1100 = 12
 5 +  8 = 0101 + 1000 = 0 1101 = 13
 5 +  9 = 0101 + 1001 = 0 1110 = 14
 5 + 10 = 0101 + 1010 = 0 1111 = 15
 5 + 11 = 0101 + 1011 = 1 0000 = 16
 5 + 12 = 0101 + 1100 = 1 0001 = 17
 5 + 13 = 0101 + 1101 = 1 0010 = 18
 5 + 14 = 0101 + 1110 = 1 0011 = 19
 5 + 15 = 0101 + 1111 = 1 0100 = 20
 6 +  0 = 0110 + 0000 = 0 0110 =  6
 6 +  1 = 0110 + 0001 = 0 0111 =  7
 6 +  2 = 0110 + 0010 = 0 1000 =  8
 6 +  3 = 0110 + 0011 = 0 1001 =  9
 6 +  4 = 0110 + 0100 = 0 1010 = 10
 6 +  5 = 0110 + 0101 = 0 1011 = 11
 6 +  6 = 0110 + 0110 = 0 1100 = 12
 6 +  7 = 0110 + 0111 = 0 1101 = 13
 6 +  8 = 0110 + 1000 = 0 1110 = 14
 6 +  9 = 0110 + 1001 = 0 1111 = 15
 6 + 10 = 0110 + 1010 = 1 0000 = 16
 6 + 11 = 0110 + 1011 = 1 0001 = 17
 6 + 12 = 0110 + 1100 = 1 0010 = 18
 6 + 13 = 0110 + 1101 = 1 0011 = 19
 6 + 14 = 0110 + 1110 = 1 0100 = 20
 6 + 15 = 0110 + 1111 = 1 0101 = 21
 7 +  0 = 0111 + 0000 = 0 0111 =  7
 7 +  1 = 0111 + 0001 = 0 1000 =  8
 7 +  2 = 0111 + 0010 = 0 1001 =  9
 7 +  3 = 0111 + 0011 = 0 1010 = 10
 7 +  4 = 0111 + 0100 = 0 1011 = 11
 7 +  5 = 0111 + 0101 = 0 1100 = 12
 7 +  6 = 0111 + 0110 = 0 1101 = 13
 7 +  7 = 0111 + 0111 = 0 1110 = 14
 7 +  8 = 0111 + 1000 = 0 1111 = 15
 7 +  9 = 0111 + 1001 = 1 0000 = 16
 7 + 10 = 0111 + 1010 = 1 0001 = 17
 7 + 11 = 0111 + 1011 = 1 0010 = 18
 7 + 12 = 0111 + 1100 = 1 0011 = 19
 7 + 13 = 0111 + 1101 = 1 0100 = 20
 7 + 14 = 0111 + 1110 = 1 0101 = 21
 7 + 15 = 0111 + 1111 = 1 0110 = 22
 8 +  0 = 1000 + 0000 = 0 1000 =  8
 8 +  1 = 1000 + 0001 = 0 1001 =  9
 8 +  2 = 1000 + 0010 = 0 1010 = 10
 8 +  3 = 1000 + 0011 = 0 1011 = 11
 8 +  4 = 1000 + 0100 = 0 1100 = 12
 8 +  5 = 1000 + 0101 = 0 1101 = 13
 8 +  6 = 1000 + 0110 = 0 1110 = 14
 8 +  7 = 1000 + 0111 = 0 1111 = 15
 8 +  8 = 1000 + 1000 = 1 0000 = 16
 8 +  9 = 1000 + 1001 = 1 0001 = 17
 8 + 10 = 1000 + 1010 = 1 0010 = 18
 8 + 11 = 1000 + 1011 = 1 0011 = 19
 8 + 12 = 1000 + 1100 = 1 0100 = 20
 8 + 13 = 1000 + 1101 = 1 0101 = 21
 8 + 14 = 1000 + 1110 = 1 0110 = 22
 8 + 15 = 1000 + 1111 = 1 0111 = 23
 9 +  0 = 1001 + 0000 = 0 1001 =  9
 9 +  1 = 1001 + 0001 = 0 1010 = 10
 9 +  2 = 1001 + 0010 = 0 1011 = 11
 9 +  3 = 1001 + 0011 = 0 1100 = 12
 9 +  4 = 1001 + 0100 = 0 1101 = 13
 9 +  5 = 1001 + 0101 = 0 1110 = 14
 9 +  6 = 1001 + 0110 = 0 1111 = 15
 9 +  7 = 1001 + 0111 = 1 0000 = 16
 9 +  8 = 1001 + 1000 = 1 0001 = 17
 9 +  9 = 1001 + 1001 = 1 0010 = 18
 9 + 10 = 1001 + 1010 = 1 0011 = 19
 9 + 11 = 1001 + 1011 = 1 0100 = 20
 9 + 12 = 1001 + 1100 = 1 0101 = 21
 9 + 13 = 1001 + 1101 = 1 0110 = 22
 9 + 14 = 1001 + 1110 = 1 0111 = 23
 9 + 15 = 1001 + 1111 = 1 1000 = 24
10 +  0 = 1010 + 0000 = 0 1010 = 10
10 +  1 = 1010 + 0001 = 0 1011 = 11
10 +  2 = 1010 + 0010 = 0 1100 = 12
10 +  3 = 1010 + 0011 = 0 1101 = 13
10 +  4 = 1010 + 0100 = 0 1110 = 14
10 +  5 = 1010 + 0101 = 0 1111 = 15
10 +  6 = 1010 + 0110 = 1 0000 = 16
10 +  7 = 1010 + 0111 = 1 0001 = 17
10 +  8 = 1010 + 1000 = 1 0010 = 18
10 +  9 = 1010 + 1001 = 1 0011 = 19
10 + 10 = 1010 + 1010 = 1 0100 = 20
10 + 11 = 1010 + 1011 = 1 0101 = 21
10 + 12 = 1010 + 1100 = 1 0110 = 22
10 + 13 = 1010 + 1101 = 1 0111 = 23
10 + 14 = 1010 + 1110 = 1 1000 = 24
10 + 15 = 1010 + 1111 = 1 1001 = 25
11 +  0 = 1011 + 0000 = 0 1011 = 11
11 +  1 = 1011 + 0001 = 0 1100 = 12
11 +  2 = 1011 + 0010 = 0 1101 = 13
11 +  3 = 1011 + 0011 = 0 1110 = 14
11 +  4 = 1011 + 0100 = 0 1111 = 15
11 +  5 = 1011 + 0101 = 1 0000 = 16
11 +  6 = 1011 + 0110 = 1 0001 = 17
11 +  7 = 1011 + 0111 = 1 0010 = 18
11 +  8 = 1011 + 1000 = 1 0011 = 19
11 +  9 = 1011 + 1001 = 1 0100 = 20
11 + 10 = 1011 + 1010 = 1 0101 = 21
11 + 11 = 1011 + 1011 = 1 0110 = 22
11 + 12 = 1011 + 1100 = 1 0111 = 23
11 + 13 = 1011 + 1101 = 1 1000 = 24
11 + 14 = 1011 + 1110 = 1 1001 = 25
11 + 15 = 1011 + 1111 = 1 1010 = 26
12 +  0 = 1100 + 0000 = 0 1100 = 12
12 +  1 = 1100 + 0001 = 0 1101 = 13
12 +  2 = 1100 + 0010 = 0 1110 = 14
12 +  3 = 1100 + 0011 = 0 1111 = 15
12 +  4 = 1100 + 0100 = 1 0000 = 16
12 +  5 = 1100 + 0101 = 1 0001 = 17
12 +  6 = 1100 + 0110 = 1 0010 = 18
12 +  7 = 1100 + 0111 = 1 0011 = 19
12 +  8 = 1100 + 1000 = 1 0100 = 20
12 +  9 = 1100 + 1001 = 1 0101 = 21
12 + 10 = 1100 + 1010 = 1 0110 = 22
12 + 11 = 1100 + 1011 = 1 0111 = 23
12 + 12 = 1100 + 1100 = 1 1000 = 24
12 + 13 = 1100 + 1101 = 1 1001 = 25
12 + 14 = 1100 + 1110 = 1 1010 = 26
12 + 15 = 1100 + 1111 = 1 1011 = 27
13 +  0 = 1101 + 0000 = 0 1101 = 13
13 +  1 = 1101 + 0001 = 0 1110 = 14
13 +  2 = 1101 + 0010 = 0 1111 = 15
13 +  3 = 1101 + 0011 = 1 0000 = 16
13 +  4 = 1101 + 0100 = 1 0001 = 17
13 +  5 = 1101 + 0101 = 1 0010 = 18
13 +  6 = 1101 + 0110 = 1 0011 = 19
13 +  7 = 1101 + 0111 = 1 0100 = 20
13 +  8 = 1101 + 1000 = 1 0101 = 21
13 +  9 = 1101 + 1001 = 1 0110 = 22
13 + 10 = 1101 + 1010 = 1 0111 = 23
13 + 11 = 1101 + 1011 = 1 1000 = 24
13 + 12 = 1101 + 1100 = 1 1001 = 25
13 + 13 = 1101 + 1101 = 1 1010 = 26
13 + 14 = 1101 + 1110 = 1 1011 = 27
13 + 15 = 1101 + 1111 = 1 1100 = 28
14 +  0 = 1110 + 0000 = 0 1110 = 14
14 +  1 = 1110 + 0001 = 0 1111 = 15
14 +  2 = 1110 + 0010 = 1 0000 = 16
14 +  3 = 1110 + 0011 = 1 0001 = 17
14 +  4 = 1110 + 0100 = 1 0010 = 18
14 +  5 = 1110 + 0101 = 1 0011 = 19
14 +  6 = 1110 + 0110 = 1 0100 = 20
14 +  7 = 1110 + 0111 = 1 0101 = 21
14 +  8 = 1110 + 1000 = 1 0110 = 22
14 +  9 = 1110 + 1001 = 1 0111 = 23
14 + 10 = 1110 + 1010 = 1 1000 = 24
14 + 11 = 1110 + 1011 = 1 1001 = 25
14 + 12 = 1110 + 1100 = 1 1010 = 26
14 + 13 = 1110 + 1101 = 1 1011 = 27
14 + 14 = 1110 + 1110 = 1 1100 = 28
14 + 15 = 1110 + 1111 = 1 1101 = 29
15 +  0 = 1111 + 0000 = 0 1111 = 15
15 +  1 = 1111 + 0001 = 1 0000 = 16
15 +  2 = 1111 + 0010 = 1 0001 = 17
15 +  3 = 1111 + 0011 = 1 0010 = 18
15 +  4 = 1111 + 0100 = 1 0011 = 19
15 +  5 = 1111 + 0101 = 1 0100 = 20
15 +  6 = 1111 + 0110 = 1 0101 = 21
15 +  7 = 1111 + 0111 = 1 0110 = 22
15 +  8 = 1111 + 1000 = 1 0111 = 23
15 +  9 = 1111 + 1001 = 1 1000 = 24
15 + 10 = 1111 + 1010 = 1 1001 = 25
15 + 11 = 1111 + 1011 = 1 1010 = 26
15 + 12 = 1111 + 1100 = 1 1011 = 27
15 + 13 = 1111 + 1101 = 1 1100 = 28
15 + 14 = 1111 + 1110 = 1 1101 = 29
15 + 15 = 1111 + 1111 = 1 1110 = 30
EOD

use Test::More;
is ($result, $ref);
done_testing();
