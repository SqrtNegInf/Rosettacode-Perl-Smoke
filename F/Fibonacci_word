#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Fibonacci_word
#c# 2018-08-03 <RC
#p# OK

use strict;
use warnings;
use feature 'say';
my $result;

sub fiboword;
{
    my ($a, $b, $count) = (1, 0, 0);
    sub fiboword {
        $count++;
        return $a if $count == 1;
        return $b if $count == 2;
        ($a, $b) = ($b, "$b$a");
        return $b;
    }
}
sub entropy {
    my %c;
    $c{$_}++ for split //, my $str = shift;
    my $e = 0;
    for (values %c) {
        my $p = $_ / length $str;
        $e -= $p * log $p;
    }
    return $e / log 2;
}

my $count;
while ($count++ < 37) {
    my $word = fiboword;
    $result .= sprintf "%5d\t%10d\t%.8e\t%s\n",
    $count,
    length($word),
    entropy($word),
    $count > 9 ? '' : $word
}

say $result; 
my $ref = <<'EOD';
    1	         1	0.00000000e+00	1
    2	         1	0.00000000e+00	0
    3	         2	1.00000000e+00	01
    4	         3	9.18295834e-01	010
    5	         5	9.70950594e-01	01001
    6	         8	9.54434003e-01	01001010
    7	        13	9.61236605e-01	0100101001001
    8	        21	9.58711883e-01	010010100100101001010
    9	        34	9.59686894e-01	0100101001001010010100100101001001
   10	        55	9.59316032e-01	
   11	        89	9.59457916e-01	
   12	       144	9.59403754e-01	
   13	       233	9.59424447e-01	
   14	       377	9.59416544e-01	
   15	       610	9.59419563e-01	
   16	       987	9.59418410e-01	
   17	      1597	9.59418850e-01	
   18	      2584	9.59418682e-01	
   19	      4181	9.59418746e-01	
   20	      6765	9.59418721e-01	
   21	     10946	9.59418731e-01	
   22	     17711	9.59418727e-01	
   23	     28657	9.59418729e-01	
   24	     46368	9.59418728e-01	
   25	     75025	9.59418728e-01	
   26	    121393	9.59418728e-01	
   27	    196418	9.59418728e-01	
   28	    317811	9.59418728e-01	
   29	    514229	9.59418728e-01	
   30	    832040	9.59418728e-01	
   31	   1346269	9.59418728e-01	
   32	   2178309	9.59418728e-01	
   33	   3524578	9.59418728e-01	
   34	   5702887	9.59418728e-01	
   35	   9227465	9.59418728e-01	
   36	  14930352	9.59418728e-01	
   37	  24157817	9.59418728e-01	
EOD

use Test::More;
is ($result, $ref);
done_testing;
