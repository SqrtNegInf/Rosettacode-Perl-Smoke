#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Table_creation
#c# 2021-12-18 <RC
#p# OK

my @res;

use strict;
use warnings;
use feature 'say';

use DBI;

my $dbh = DBI->connect("dbi:SQLite:dbname=:memory:");

$dbh->do("CREATE TABLE stocks (
   date TEXT, trans TEXT, symbol TEXT, qty REAL, price REAL 
)");

my $sth = $dbh->prepare( "INSERT INTO stocks VALUES (?,?,?,?,?)" );

my @DATA = ( '"2006-01-05","BUY", "RHAT",  100, 35.14',
             '"2006-03-28","BUY",  "IBM", 1000, 45.00',
             '"2006-04-05","BUY","MSOFT", 1000, 72.00',
             '"2006-04-06","SELL", "IBM",  500,  53.00' );

for ( @DATA ) { $sth->execute( split /,/ ) or die }

$sth = $dbh->prepare("SELECT * FROM stocks ORDER BY price") or die;

$sth->execute();

my $format = "%-15s %-15s %-15s %-15s %-15s\n";

#printf $format, $sth->{NAME}->@* ;
#print '=' x 75 , "\n";

while ( my @row = $sth->fetchrow_array ) { push @res, (sprintf $format, @row) =~ s/\s+$/\n/r }

say my $result = join '', @res;

#date            trans           symbol          qty             price
#===========================================================================
my $ref = <<'EOD';
"2006-01-05"    "BUY"            "RHAT"         100             35.14
"2006-03-28"    "BUY"             "IBM"         1000            45
"2006-04-06"    "SELL"           "IBM"          500             53
"2006-04-05"    "BUY"           "MSOFT"         1000            72
EOD

use Test::More;
is ($result, $ref);
done_testing;
