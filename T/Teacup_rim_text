#!/usr/local/bin/perl
#u# http://rosettacode.org/wiki/Teacup_rim_text
#t# inprogress
#c# 2019-10-xx >RC
#p# OK

#use Data::Printer;
use Data::Dumper;
use Time::HiRes qw(sleep);

use strict;
use warnings;
use feature 'say';

my @res;

my %words;
open my $fh, '<', 'ref/wordlist.10000';
while ($_ = <$fh>) {
    next if length($_) < 3;
#    next unless /^pos/;
    my $w = uc $_;
    push @{$words{join '', sort split //, $w}}, $w;
}

p $words{'OPST'}; exit;
#print Dumper(%words); exit;

say my $result = join "\n", @res;

my $ref = <<'END';
AIM, IMA, MAI
ARC, RCA, CAR
ASP, SPA, PAS
ATE, TEA, EAT
IPS, PSI, SIP
END

use Test::More;
chomp $ref;
is($result, $ref);
done_testing();

__END__

for %words.keys { %words{$_}:delete if %words{$_}.elems < 2 or $_.chars < 3 };

my @teacups;
my %seen;

for %words.values -> @these {
    next if @these < 2;
    MAYBE: for @these {
        my $maybe = $_;
        next if %seen{$_};
        my @print;
        for ^$maybe.chars {
            if $maybe âˆˆ @these {
                @print.push: $maybe;
                $maybe = $maybe.comb.list.rotate.join;
            } else {
                @print = ();
                next MAYBE
            }
        }
        if @print.elems {
            @teacups.push: @print;
            %seen{$_}++ for @print;
        }
    }
}

@res.push: $_.unique.join(", ") if .elems for sort @teacups;


=={{header|Perl}}==
{{trans|Perl 6}}
<lang perl></lang>
{{out}}
<pre style="height:20ex"></pre>
[https://github.com/SqrtNegInf/Rosettacode-Perl5-Smoke/blob/master/ref/XXX XXX]
